# N.E.K.O.-RN 开发路线图

> 基于主项目功能对比，规划 RN 移动端开发路线
>
> 创建日期: 2026-02-20
>
> 当前版本: v1.0.0-stable

---

## 目录

1. [项目现状总览](#1-项目现状总览)
2. [功能对比矩阵](#2-功能对比矩阵)
3. [开发阶段规划](#3-开发阶段规划)
4. [详细功能规划](#4-详细功能规划)
5. [技术架构演进](#5-技术架构演进)
6. [里程碑与交付计划](#6-里程碑与交付计划)

---

## 1. 项目现状总览

### 1.1 主项目前端状态

> **重要说明**: 主项目目前处于 **React 前端重写阶段**，存在两套前端：

| 前端版本 | 位置 | 状态 | 说明 |
|---------|------|------|------|
| **旧版 HTML/JS** | `templates/` | 生产使用 | main 分支，12 个 HTML 页面 |
| **新版 React** | `frontend/` | 开发中 | feature/frontend-rewrite 分支，65% 完成 |

**React 前端重写进度**:
- ✅ Phase 1-3: 页面迁移、API 集成、WebSocket 完成
- 🔶 Phase 4: 功能测试进行中 (40%)
- ⬜ Phase 5-8: 国际化、性能优化、部署待完成

### 1.2 架构对比

| 层级 | 主项目 (新版 React) | 主项目 (旧版 HTML) | RN 项目 |
|------|---------------------|-------------------|---------|
| **前端框架** | React + Vite | HTML + Vanilla JS | React Native + Expo |
| **路由** | React Router | 服务端渲染 | Expo Router |
| **状态管理** | useState/useRef | 全局变量 | useState/useRef |
| **WebSocket** | 原生 WebSocket | 原生 WebSocket | @project_neko/realtime |
| **音频** | Web Audio API | Web Audio API | react-native-pcm-stream |
| **Live2D** | pixi-live2d-display | pixi-live2d-display | react-native-live2d |
| **3D 模型** | @pixiv/three-vrm | @pixiv/three-vrm | 待实现 |

### 1.3 RN 项目当前完成度

```
核心功能:     ████████████████████░░░░░ 80%
管理页面:     ████████░░░░░░░░░░░░░░░░ 30%
体验优化:     ████░░░░░░░░░░░░░░░░░░░░ 15%
平台适配:     ████████░░░░░░░░░░░░░░░░ 30%
```

---

## 2. 功能对比矩阵

### 2.1 核心交互功能

| 功能 | 主项目 | RN 项目 | 优先级 | 预估工时 |
|------|--------|---------|--------|----------|
| 文本聊天 | ✅ | ✅ | - | - |
| 语音聊天 | ✅ | ✅ | - | - |
| WebSocket 连接 | ✅ | ✅ | - | - |
| 自动重连 | ✅ | ✅ | - | - |
| 心跳保活 | ✅ | ✅ | - | - |
| 会话管理 | ✅ | ✅ | - | - |
| 语音打断 | ✅ | ⏳ | P0 | 3天 |
| 后台音频播放 | ❌ | ⏳ | P0 | 2天 |
| 多轮对话 | ✅ | ✅ | - | - |

### 2.2 角色显示功能

| 功能 | 主项目 | RN 项目 | 优先级 | 预估工时 |
|------|--------|---------|--------|----------|
| Live2D 模型加载 | ✅ | ✅ | - | - |
| Live2D 表情控制 | ✅ | ✅ | - | - |
| Live2D 动作播放 | ✅ | ✅ | - | - |
| Live2D 唇同步 | ✅ | ✅ | - | - |
| Live2D 自动眨眼 | ✅ | ✅ | - | - |
| Live2D 自动呼吸 | ✅ | ✅ | - | - |
| Live2D 手势交互 | ✅ | ❌ | P2 | 3天 |
| Live2D 参数编辑器 | ✅ | ❌ | P3 | 5天 |
| VRM 模型支持 | ✅ | ❌ | P2 | 10天 |
| VRM 表情系统 | ✅ | ❌ | P2 | 5天 |

### 2.3 管理页面功能

| 功能 | 主项目 | RN 项目 | 优先级 | 预估工时 |
|------|--------|---------|--------|----------|
| 角色管理 | ✅ | ✅ | - | - |
| 角色创建/编辑 | ✅ | ✅ | - | - |
| 角色切换 | ✅ | ✅ | - | - |
| API Key 设置 | ✅ | ✅ | - | - |
| API 提供商切换 | ✅ | ✅ | - | - |
| 记忆浏览器 | ✅ | ❌ | P1 | 5天 |
| 记忆搜索 | ✅ | ❌ | P1 | 3天 |
| 模型管理 | ✅ | ❌ | P2 | 4天 |
| 音色克隆 | ✅ | ❌ | P2 | 5天 |
| 创意工坊 | ✅ | ❌ | P3 | 7天 |
| Live2D 表情管理 | ✅ | ❌ | P3 | 4天 |
| VRM 表情管理 | ✅ | ❌ | P3 | 4天 |

### 2.4 Agent 功能

| 功能 | 主项目 | RN 项目 | 优先级 | 预估工时 |
|------|--------|---------|--------|----------|
| Agent 状态显示 | ✅ | ✅ | - | - |
| MCP 工具调用 | ✅ | ❌ | P2 | 5天 |
| Computer Use | ✅ | ❌ | P3 | 7天 |
| Browser Use | ✅ | ❌ | P3 | 7天 |
| 任务进度显示 | ✅ | ⏳ | P1 | 3天 |
| 任务历史 | ✅ | ❌ | P2 | 4天 |

### 2.5 多媒体功能

| 功能 | 主项目 | RN 项目 | 优先级 | 预估工时 |
|------|--------|---------|--------|----------|
| 摄像头拍照 | ✅ | ❌ | P1 | 3天 |
| 图片发送 | ✅ | ❌ | P1 | 2天 |
| 屏幕共享 | ✅ | ❌ | P3 | 5天 |
| 视频预览 | ✅ | ❌ | P2 | 4天 |
| 图片识别 | ✅ | ❌ | P1 | 2天 |

### 2.6 系统功能

| 功能 | 主项目 | RN 项目 | 优先级 | 预估工时 |
|------|--------|---------|--------|----------|
| 国际化 (i18n) | ✅ | ⏳ | P1 | 4天 |
| 深色模式 | ⏳ | ❌ | P2 | 3天 |
| 主题定制 | ❌ | ❌ | P3 | 5天 |
| 推送通知 | ❌ | ❌ | P2 | 5天 |
| 本地通知 | ❌ | ❌ | P2 | 3天 |
| 快捷操作 | ❌ | ❌ | P3 | 3天 |
| Widget | ❌ | ❌ | P3 | 7天 |

### 2.7 体验优化

| 功能 | 主项目 | RN 项目 | 优先级 | 预估工时 |
|------|--------|---------|--------|----------|
| 音量可视化 | ⏳ | ❌ | P1 | 2天 |
| 连接状态指示 | ✅ | ✅ | - | - |
| 加载动画 | ✅ | ⏳ | P1 | 2天 |
| 错误提示 | ✅ | ✅ | - | - |
| 手势优化 | ✅ | ⏳ | P1 | 3天 |
| 性能监控 | ❌ | ❌ | P2 | 3天 |
| 崩溃收集 | ❌ | ❌ | P2 | 2天 |

---

## 3. 开发阶段规划

### Phase 1: 核心体验完善 (2周)

**目标**: 提升核心交互体验，确保稳定性

| 任务 | 优先级 | 状态 |
|------|--------|------|
| 语音打断功能 | P0 | ⏳ |
| 后台音频播放 | P0 | ⏳ |
| 音量可视化 | P1 | 📋 |
| 加载动画优化 | P1 | 📋 |
| 手势交互优化 | P1 | 📋 |
| 多设备兼容测试 | P0 | 📋 |

**交付物**:
- 流畅的语音交互体验
- 稳定的后台运行
- 基础体验优化

---

### Phase 2: 功能补全 (3周)

**目标**: 补全关键管理功能

| 任务 | 优先级 | 状态 |
|------|--------|------|
| 记忆浏览器 | P1 | 📋 |
| 记忆搜索 | P1 | 📋 |
| 摄像头拍照 | P1 | 📋 |
| 图片发送 | P1 | 📋 |
| 图片识别 | P1 | 📋 |
| 国际化 (i18n) | P1 | 📋 |
| Agent 任务进度 | P1 | 📋 |

**交付物**:
- 完整的记忆管理
- 图片交互能力
- 多语言支持

---

### Phase 3: 高级功能 (4周)

**目标**: 实现高级特性，对齐主项目

| 任务 | 优先级 | 状态 |
|------|--------|------|
| VRM 模型支持 | P2 | 📋 |
| VRM 表情系统 | P2 | 📋 |
| 模型管理页面 | P2 | 📋 |
| 音色克隆 | P2 | 📋 |
| MCP 工具调用 | P2 | 📋 |
| 深色模式 | P2 | 📋 |
| 推送通知 | P2 | 📋 |
| 性能监控 | P2 | 📋 |

**交付物**:
- VRM 模型完整支持
- 高级 Agent 功能
- 完善的系统功能

---

### Phase 4: 发布准备 (2周)

**目标**: 准备应用发布

| 任务 | 优先级 | 状态 |
|------|--------|------|
| iOS 真机测试 | P1 | 📋 |
| 应用签名 | P1 | 📋 |
| EAS Build 配置 | P1 | 📋 |
| 应用商店素材 | P1 | 📋 |
| 隐私政策 | P1 | 📋 |
| 内测发布 | P1 | 📋 |
| 创意工坊 | P3 | 📋 |
| Computer Use | P3 | 📋 |

**交付物**:
- 可发布的 APK/IPA
- 完整的发布流程

---

## 4. 详细功能规划

### 4.1 语音打断功能 (P0)

**描述**: 用户说话时自动打断 AI 回复

**技术方案**:
```typescript
// 1. 监听用户语音活动
// 2. 检测到用户说话时发送打断信号
// 3. 服务端停止 TTS 输出
// 4. 客户端停止音频播放
```

**实现步骤**:
1. 在 `AudioService` 中添加 VAD (语音活动检测)
2. 处理 `user_activity` 消息
3. 实现音频播放的中断逻辑
4. 添加 UI 反馈

**涉及文件**:
- `services/AudioService.ts`
- `services/wsService.ts`
- `packages/project-neko-audio-service/`

---

### 4.2 后台音频播放 (P0)

**描述**: 应用在后台时继续播放 AI 语音

**技术方案**:
```typescript
// 1. 配置 Android 后台服务
// 2. 使用 expo-av 或 react-native-track-player
// 3. 添加前台服务通知
// 4. 处理音频焦点
```

**实现步骤**:
1. 配置 `AndroidManifest.xml` 添加前台服务权限
2. 实现后台音频播放服务
3. 添加通知控制
4. 处理音频焦点和中断

**涉及文件**:
- `android/app/src/main/AndroidManifest.xml`
- `services/AudioService.ts`
- 新增: `services/BackgroundAudioService.ts`

---

### 4.3 记忆浏览器 (P1)

**描述**: 查看和管理 AI 的记忆内容

**API 接口**:
```
GET  /memory/get_recent_history/{character_name}?limit=50
GET  /memory/search_for_memory/{character_name}/{query}
POST /memory/new_dialog/{character_name}
```

**UI 设计**:
```
┌────────────────────────────┐
│  记忆浏览器                  │
├────────────────────────────┤
│  🔍 搜索记忆...              │
├────────────────────────────┤
│  📅 今天                     │
│  ├─ 用户说喜欢猫咪            │
│  └─ AI 记住用户有 allergies   │
├────────────────────────────┤
│  📅 昨天                     │
│  └─ ...                     │
├────────────────────────────┤
│  [新建对话] [清空记忆]        │
└────────────────────────────┘
```

**涉及文件**:
- 新增: `app/memory-browser.tsx`
- 新增: `services/api/memory.ts`

---

### 4.4 摄像头 & 图片 (P1)

**描述**: 拍照和发送图片给 AI 识别

**技术方案**:
```typescript
// 1. 使用 expo-image-picker
// 2. 压缩图片
// 3. 转 base64 发送
// 4. 通过 WebSocket stream_data 发送
```

**消息格式**:
```json
{
  "action": "stream_data",
  "input_type": "camera",
  "data": ["base64_image_data"]
}
```

**实现步骤**:
1. 安装 expo-image-picker
2. 在 ChatContainer 中添加相机按钮
3. 实现图片选择/拍照
4. 实现图片压缩和上传

**涉及文件**:
- `packages/project-neko-components/`
- `services/wsService.ts`
- `app/(tabs)/main.tsx`

---

### 4.5 国际化 (P1)

**描述**: 支持多语言界面

**支持语言**:
- 简体中文 (zh-CN) - 默认
- English (en)
- 日本語 (ja)
- 繁體中文 (zh-TW)
- 한국어 (ko)

**技术方案**:
```typescript
// 使用 i18next + react-i18next
// 语言包存储在本地
// 从服务端同步语言包
```

**实现步骤**:
1. 安装 i18next 依赖
2. 创建语言包文件
3. 配置 i18n 初始化
4. 替换所有硬编码文本
5. 添加语言切换设置

**涉及文件**:
- 新增: `i18n/`
- 修改: 所有 UI 组件

---

### 4.6 VRM 模型支持 (P2)

**描述**: 支持 VRM 3D 角色模型

**技术挑战**:
- React Native 没有 WebGL
- 需要使用 react-native-three-fs 或 expo-gl
- VRM 解析需要 three.js

**技术方案**:
```typescript
// 方案 A: expo-gl + three.js (性能较好)
// 方案 B: WebView 内嵌 (兼容性好)
// 方案 C: 原生模块 (最优性能)
```

**实现步骤**:
1. 调研 expo-gl + @pixiv/three-vrm 兼容性
2. 实现基础 VRM 加载
3. 实现表情控制
4. 实现动画系统

**涉及文件**:
- 新增: `packages/react-native-vrm/`
- 新增: `services/VRMService.ts`

---

### 4.7 Agent 功能 (P2)

**描述**: 在移动端查看和控制 Agent 任务

**API 接口**:
```
GET  /agent/flags
POST /agent/flags
GET  /agent/health
GET  /agent/availability
```

**UI 设计**:
```
┌────────────────────────────┐
│  Agent 控制面板              │
├────────────────────────────┤
│  🤖 MCP 工具      [ON/OFF]  │
│  💻 Computer Use [ON/OFF]  │
│  🌐 Browser Use  [ON/OFF]  │
│  🔌 用户插件     [ON/OFF]  │
├────────────────────────────┤
│  📋 当前任务                 │
│  ┌────────────────────────┐ │
│  │ 正在搜索天气预报...      │ │
│  │ ████████░░ 80%         │ │
│  └────────────────────────┘ │
├────────────────────────────┤
│  📜 任务历史                 │
│  └─ 查看全部 →              │
└────────────────────────────┘
```

---

### 4.8 推送通知 (P2)

**描述**: AI 主动发送通知给用户

**技术方案**:
```typescript
// 1. 使用 expo-notifications
// 2. 后端通过 FCM/APNs 发送
// 3. 前端注册推送 token
// 4. 处理通知点击
```

**实现步骤**:
1. 配置 Firebase 项目 (Android)
2. 配置 APNs (iOS)
3. 实现推送 token 注册
4. 实现通知处理逻辑

**涉及文件**:
- 新增: `services/PushNotificationService.ts`
- 修改: `app/_layout.tsx`

---

## 5. 技术架构演进

### 5.1 当前架构

```
┌─────────────────────────────────────────────┐
│                  App Layer                   │
│  ┌─────────┐ ┌─────────┐ ┌─────────────────┐│
│  │  main   │ │settings │ │character-manager││
│  └────┬────┘ └────┬────┘ └────────┬────────┘│
├───────┼───────────┼────────────────┼─────────┤
│       │   Hooks Layer               │         │
│  ┌────┴────┐ ┌─────┴─────┐ ┌───────┴───────┐ │
│  │useChat  │ │useLive2D  │ │useAudio       │ │
│  └────┬────┘ └─────┬─────┘ └───────┬───────┘ │
├───────┼───────────┼────────────────┼─────────┤
│       │   Service Layer             │         │
│  ┌────┴────┐ ┌─────┴─────┐ ┌───────┴───────┐ │
│  │wsService│ │Live2DSvc │ │AudioService   │ │
│  └────┬────┘ └─────┬─────┘ └───────┬───────┘ │
├───────┼───────────┼────────────────┼─────────┤
│       │   Native Modules           │         │
│  ┌────┴────┐ ┌─────┴─────┐ ┌───────┴───────┐ │
│  │realtime │ │live2d    │ │pcm-stream     │ │
│  └─────────┘ └───────────┘ └───────────────┘ │
└─────────────────────────────────────────────┘
```

### 5.2 目标架构

```
┌─────────────────────────────────────────────┐
│                  App Layer                   │
│  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────────┐│
│  │ main  │ │settings│ │memory │ │ agent     ││
│  └───┬───┘ └───┬───┘ └───┬───┘ └─────┬─────┘│
├──────┼─────────┼─────────┼───────────┼───────┤
│      │   State Management (Zustand)  │       │
│  ┌───┴───┐ ┌───┴───┐ ┌───┴───┐ ┌─────┴─────┐│
│  │chat   │ │ui     │ │user   │ │agent      ││
│  │Store  │ │Store  │ │Store  │ │Store      ││
│  └───┬───┘ └───┬───┘ └───┬───┘ └─────┬─────┘│
├──────┼─────────┼─────────┼───────────┼───────┤
│      │   Hooks / Controllers        │       │
│  ┌───┴───────────┴───────────┴───────────┐ │
│  │         useAppController              │ │
│  └───┬───────────┬───────────┬───────────┘ │
├──────┼───────────┼───────────┼─────────────┤
│      │   Service Layer                 │     │
│  ┌───┴───┐ ┌─────┴─────┐ ┌─────┴───────┐   │
│  │wsSvc  │ │Live2DSvc  │ │AudioSvc     │   │
│  │VRMSvc │ │MemorySvc  │ │PushSvc      │   │
│  └───┬───┘ └─────┬─────┘ └─────┬───────┘   │
├──────┼───────────┼───────────┼─────────────┤
│      │   Native Modules             │       │
│  ┌───┴───┐ ┌─────┴─────┐ ┌─────┴───────┐   │
│  │realtime│ │live2d/vrm│ │pcm-stream   │   │
│  │camera  │ │fs        │ │notifications│   │
│  └───────┘ └───────────┘ └─────────────┘   │
└─────────────────────────────────────────────┘
```

### 5.3 新增依赖

```json
{
  "dependencies": {
    "zustand": "^4.5.0",
    "i18next": "^23.0.0",
    "react-i18next": "^14.0.0",
    "expo-image-picker": "^15.0.0",
    "expo-notifications": "^0.28.0",
    "expo-camera": "^15.0.0",
    "@react-native-community/netinfo": "^11.0.0",
    "react-native-background-timer": "^2.4.0"
  }
}
```

---

## 6. 里程碑与交付计划

### 里程碑时间线

```
2026-02 ──────────────────────────────────────────────►
    │
    ├── v1.1.0 (Phase 1 完成)
    │   └── 核心体验完善
    │       - 语音打断
    │       - 后台播放
    │       - 体验优化
    │
    ├── v1.2.0 (Phase 2 完成)
    │   └── 功能补全
    │       - 记忆浏览器
    │       - 图片功能
    │       - 国际化
    │
    ├── v1.3.0 (Phase 3 完成)
    │   └── 高级功能
    │       - VRM 支持
    │       - Agent 功能
    │       - 系统功能
    │
    └── v2.0.0 (Phase 4 完成)
        └── 正式发布
            - iOS 支持
            - 应用商店上架
```

### 版本规划

| 版本 | 目标日期 | 主要内容 |
|------|---------|----------|
| v1.1.0 | 2026-03-06 | 核心体验完善 |
| v1.2.0 | 2026-03-27 | 功能补全 |
| v1.3.0 | 2026-04-24 | 高级功能 |
| v2.0.0 | 2026-05-08 | 正式发布 |

---

## 附录

### A. 主项目功能参考

详见主项目分析报告 (Explore agent 输出)

### B. RN 项目现有功能

详见 RN 项目分析报告 (Explore agent 输出)

### C. 相关文档

- [STABLE_RELEASE_SUMMARY.md](../STABLE_RELEASE_SUMMARY.md) - 稳定版本发布说明
- [ROADMAP.md](./ROADMAP.md) - 原有路线图
- [rn-development-guide.md](./guides/rn-development-guide.md) - 开发指南

---

**文档版本**: 1.0
**最后更新**: 2026-02-20
**维护者**: N.E.K.O Team
